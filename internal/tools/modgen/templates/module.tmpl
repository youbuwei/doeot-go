package {{ .ModuleName }}

import (
	"{{ .ModPath }}/internal/{{ .ModuleName }}/app"
	"{{ .ModPath }}/internal/{{ .ModuleName }}/infra/repo"
	"{{ .ModPath }}/internal/{{ .ModuleName }}/interfaces/endpoint"
	http "{{ .ModPath }}/internal/{{ .ModuleName }}/interfaces/http"
	rpc "{{ .ModPath }}/internal/{{ .ModuleName }}/interfaces/rpc"
	"{{ .ModPath }}/pkg/biz"
	"gorm.io/gorm"
)

// Module 实现 biz.Module，用于注册 {{ .ModuleName }} 模块的 HTTP/RPC 路由。
type Module struct {
	ep *endpoint.{{ .TypeName }}Endpoint
}

// NewModule 组装 {{ .ModuleName }} 模块的依赖关系。
func NewModule(db *gorm.DB) *Module {
	r := repo.NewRepo(db)
	svc := app.New{{ .TypeName }}Service(r)
	ep := &endpoint.{{ .TypeName }}Endpoint{Svc: svc}
	return &Module{ep: ep}
}

func (m *Module) Name() string { return "{{ .ModuleName }}" }

func (m *Module) RegisterHTTP(r biz.Router) {
	http.RegisterRoutes(r, m.ep)
}

func (m *Module) RegisterRPC(r biz.RPCRouter) {
	rpc.RegisterRPC(r, m.ep)
}
